<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f9fa;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .header h1 {
      color: #1a73e8;
      margin: 0;
      font-size: 20px;
    }
    
    .info-box {
      background-color: #e8f0fe;
      border: 1px solid #1a73e8;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .info-box h3 {
      margin: 0 0 10px 0;
      color: #1a73e8;
      font-size: 16px;
    }
    
    .info-box p {
      margin: 5px 0;
      color: #3c4043;
      font-size: 14px;
    }
    
    .info-box code {
      background-color: #f1f3f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    
    .status-indicator {
      background-color: #f8f9fa;
      border: 1px solid #dadce0;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
    }
    
    .status-indicator.success {
      background-color: #e6f4ea;
      border-color: #34a853;
      color: #137333;
    }
    
    .status-indicator.error {
      background-color: #fce8e6;
      border-color: #ea4335;
      color: #d93025;
    }
    
    .status-indicator.warning {
      background-color: #fef7e0;
      border-color: #f9ab00;
      color: #b06000;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .btn-primary {
      background-color: #1a73e8;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #1557b0;
    }
    
    .btn-secondary {
      background-color: #f8f9fa;
      color: #3c4043;
      border: 1px solid #dadce0;
    }
    
    .btn-secondary:hover {
      background-color: #f1f3f4;
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .error {
      background-color: #fce8e6;
      color: #d93025;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      display: none;
    }
    
    .success {
      background-color: #e6f4ea;
      color: #137333;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚öôÔ∏è Settings</h1>
    </div>
    
    <div class="info-box">
      <h3>üîë API Key Configuration</h3>
      <p>This add-on uses Google's Gemini AI to process meeting transcripts. Your API key is configured in the Apps Script project properties.</p>
      <p><strong>To update your API key:</strong> Go to the Apps Script project settings and modify the <code>GEMINI_API_KEY</code> property.</p>
    </div>
    
    <div class="error" id="error-message"></div>
    <div class="success" id="success-message"></div>
    
    <div class="status-indicator" id="api-status">
      <strong>API Key Status:</strong> <span id="status-text">Checking...</span>
    </div>
    
    <div class="button-group">
      <button type="button" id="test-btn" class="btn btn-secondary">üß™ Test API Key</button>
      <button type="button" id="refresh-btn" class="btn btn-primary">üîÑ Refresh Status</button>
    </div>
  </div>

  <script>
    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      
      const successDiv = document.getElementById('success-message');
      successDiv.style.display = 'none';
    }
    
    function showSuccess(message) {
      const successDiv = document.getElementById('success-message');
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      
      const errorDiv = document.getElementById('error-message');
      errorDiv.style.display = 'none';
    }
    
    function updateStatus(status, message) {
      const statusDiv = document.getElementById('api-status');
      const statusText = document.getElementById('status-text');
      
      statusDiv.className = 'status-indicator ' + status;
      statusText.textContent = message;
    }
    
    function testApiKey() {
      const testBtn = document.getElementById('test-btn');
      testBtn.disabled = true;
      testBtn.textContent = 'Testing...';
      
      google.script.run
        .withSuccessHandler(function(result) {
          testBtn.disabled = false;
          testBtn.textContent = 'üß™ Test API Key';
          
          if (result.success) {
            showSuccess(result.message);
            updateStatus('success', '‚úÖ Working correctly');
          } else {
            showError(result.message);
            updateStatus('error', '‚ùå ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          testBtn.disabled = false;
          testBtn.textContent = 'üß™ Test API Key';
          showError('Test failed: ' + error);
          updateStatus('error', '‚ùå Test failed');
        })
        .testApiKey();
    }
    
    function refreshStatus() {
      const refreshBtn = document.getElementById('refresh-btn');
      refreshBtn.disabled = true;
      refreshBtn.textContent = 'Refreshing...';
      
      google.script.run
        .withSuccessHandler(function(hasKey) {
          refreshBtn.disabled = false;
          refreshBtn.textContent = 'üîÑ Refresh Status';
          
          if (hasKey) {
            updateStatus('success', '‚úÖ Configured');
            showSuccess('API key is configured in script properties');
          } else {
            updateStatus('warning', '‚ö†Ô∏è Not configured');
            showError('API key not found in script properties');
          }
        })
        .withFailureHandler(function(error) {
          refreshBtn.disabled = false;
          refreshBtn.textContent = 'üîÑ Refresh Status';
          showError('Failed to check status: ' + error);
          updateStatus('error', '‚ùå Error checking status');
        })
        .checkApiKeyStatus();
    }
    
    // Load current API key status on page load
    window.onload = function() {
      refreshStatus();
    };
    
    // Add event listeners
    document.getElementById('test-btn').addEventListener('click', testApiKey);
    document.getElementById('refresh-btn').addEventListener('click', refreshStatus);
  </script>
</body>
</html>